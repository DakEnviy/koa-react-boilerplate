# React starterkit


[![Dependency Status](https://david-dm.org/albertogasparin/react-starterkit.svg?style=flat-square)](https://david-dm.org/albertogasparin/react-starterkit)
[![devDependency Status](https://david-dm.org/albertogasparin/react-starterkit/dev-status.svg?style=flat-square)](https://david-dm.org/albertogasparin/react-starterkit#info=devDependencies)
[![License](http://img.shields.io/:license-mit-blue.svg)](http://albertogasparin.mit-license.org)

Server: Koa, React + router + Redux isomorphic rendering, Jade  
Client: React + router + Redux, Sass



## Setup

``` sh
npm install
```



## Development

To start the node server (watching) run:
``` sh
npm run watch
```
The default browser entry point while developing is `127.0.0.1:3000`. 
Webpack middleware will handle all `/assets` requests, while all other requests will be handled by Koa



## Testing

Tests are run with Mocha + Expect for both client and server:
``` sh
npm run test 
# or
npm run test:watch # for TDD
```
React components testing is done with [Enzyme](https://github.com/airbnb/enzyme/), a library that allows you to use a jQuery-like API to query the virtual dom.

Code coverage reports are also available thanks to [Nyc](https://github.com/bcoe/nyc):
``` sh
npm run coverage
```


## Production

First, build the JS file and the CSS file (extracted):
``` sh
npm run build
```

To run node with production env:
``` sh
NODE_ENV=production npm run start
```
Now `127.0.0.1:3000` will serve your entire app.

##### No need of a node server?

``` sh
npm run build:template
```
Will compile and save the template (and your isomorphic app) to `public/index.html`, ready to be statically served together with the assets generated by the `build` command. 



## ENV variables

You can dynamically change some behaviors of the app by either prepending these props to the shell command or by adding them to a `.env` file. The defaults set in `lib/config.js` are:

**NODE_ENV** `string`  
Set node environment: `development`, `test`, `production` (default: `development`)

**HOST** `string`  
Koa server host IP address (default: `127.0.0.1`)

**PORT** `int`  
Koa server listening port (default: `3000`)

**COOKIE_SECRET** `string`  
Set the string used to encrypt (default: `cookie-secret`)

**GA_PROPERTY** `string`  
Set the Google Analytics property and renders the dedicated script tag (default: `''`)

**PUBLIC_PATH** `string`  
The base path for assets and, eventually, Ajax requests (default: `/`). During development it is forced to `http://HOST:PORT/` to fix a [css-loader assets bug](https://github.com/webpack/css-loader/issues/29). Available also client-side as `CONFIG.publicPath`.



## Config variables

You can persistently change some behaviors of the app by tweaking `lib/config.js`. Most interesting options are:

**isomorphic** `bool`  
Toggle on/off React server-side rendering (default: `true`)  
NOTE: this will make node no longer return 404s. You'll have to handle them client-side or by tweaking `router.react.path` 

**router.api** `{ prefix, folder }`  
Defines API files location and the common URL prefix 

**router.react** `{ path, template, routes, store }`  
Defines which paths render the React template, plus where to find React routes and Redux store



## Adding API endpoints

The current implementation loads automatically all modules inside `./api` folder. 
To create a set of endpoints `/api/users` for instance, add `users/index.js` inside the `./api` folder. Then define your methods (like `list()`, `create()`, ...) and export an object with:  
  - keys: `GET/POST/PUT/DELETE` *space* `name`
  - values: the generator function that will be called by the router

``` js
const API = {
  'GET /todos': list,
  'POST /todos': create,
  'PUT /todos/:id': update,
};
export default API;
```



## How to

**Passing config variables client-side**  
Properties defined in `./lib/config` are not automatically available client-side. In order to expose them, you have to individually define `CONFIG.myKey` in webpack.DefinePlugin [configuration](https://github.com/albertogasparin/react-starterkit/blob/master/webpack.config.js#L159).

**Building for deploying into subfolders**  
By default the assets url prefix is `/`. By setting `PUBLIC_PATH` in `.env`, you can customize this prefix. For instance, to generate a static build that works regardless of the parent folder, just set `PUBLIC_PATH=./` (and switch react router history to [hash history](https://github.com/rackt/react-router/blob/master/docs/guides/basics/Histories.md)). 

**Getting rid of React-router**  
You can easily get rid of it on the client side by removing `routes`, `history` and `react-router-redux` code from `app/client.js`, `app/store.js` and `app/reducers/index.js`. The minified bundle size will be reduced by ~100kB. The router can still be used server-side to provide 404s and redirects.

**Manually (and quickly) restart the server**  
Just type `rs` in the console and press enter. [node-supervisor](https://github.com/petruisfan/node-supervisor) will do the rest.



## Troubleshooting

**Missing CSS while serving the built bundle**  
The external CSS file is loaded by `index.jade` only if the node env is not `development`.  
Try: `NODE_ENV=test npm run start`

**Missing CSS-defined assets when testing on a VM or network-connected device**  
This is a known limitation of [style-loader](https://github.com/webpack/style-loader/issues/55). The assets URL produced by that loader are absolute, so you need to explicitly set your host LAN IP address.  
Example: `HOST=192.168.1.2 npm run watch`

**Startup / build time incredibly slow**  
Make sure you are using npm@3, as it [makes compilation 2x to 5x faster](https://phabricator.babeljs.io/T3067). If you are on npm@2, delete `node_modules` folder, update npm globally with `npm install -g npm` and then reinstall your deps.



## Useful addons & packages

- [scroll-behavior](https://github.com/rackt/scroll-behavior)  
  Adds scroll behaviors (scroll to top / restore) on route change
- [react-helmet](https://github.com/nfl/react-helmet)  
  Change doc `head` (title, meta, ...) from within components (w/ server support)
- [immutable-js](https://github.com/facebook/immutable-js) / [seamless-immutable](https://github.com/rtfeldman/seamless-immutable)  
  Immutable data / helpers
- [redux-batched-subscribe](https://github.com/tappleby/redux-batched-subscribe)  
  Batch redux updates to avoid multiple re-renders
- [react-autobind](https://github.com/cassiozen/React-autobind)  
  Auto-binding React class methods  



**Similar projects**  
[react-redux-starter-kit](https://github.com/davezuko/react-redux-starter-kit), 
[isomorphic-redux](https://github.com/bananaoomarang/isomorphic-redux), 
[react-redux-isomorphic-hot-boilerplate](https://github.com/inxilpro/react-redux-isomorphic-hot-boilerplate), 
[react-redux-isomorphic-example](https://github.com/coodoo/react-redux-isomorphic-example), 
[redux-universal-app](https://github.com/eriknyk/redux-universal-app)

